var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;import{_ as n}from"./AlertModal-aca3c6d1.js";import{_ as r}from"./DynamicTextarea-daa9e12b.js";import{_ as i}from"./FormInputText-1d6b880e.js";import{_ as l}from"./CoverUpload-8a46543d.js";import{ao as c,m,r as u,o as d,c as g,a as h,d as f,e as p,t as v,s as b,u as w,w as y,D as x}from"./vendor-385d4c3c.js";import{c as I,a as C}from"./object-9b840b78.js";import{_ as S,i as j,V as N,W as B,X as $}from"./index-4bc7a5c9.js";const U={name:"UserProfile",components:{CoverUpload:l,DynamicTextarea:r,AlertModal:n},emits:["get-info"],data(){const e=I().shape({"user-new-name":C().required()}),{value:t,errorMessage:a}=c("user-introduction",C().nullable().max(300));return{nameSchema:e,avatarImage:null,isShowNameInput:!1,userIntroduction:t,introError:a,alertInfo:null}},computed:((e,n)=>{for(var r in n||(n={}))a.call(n,r)&&s(e,r,n[r]);if(t)for(var r of t(n))o.call(n,r)&&s(e,r,n[r]);return e})({},m(["userInfo"])),mounted(){this.userIntroduction=this.userInfo.Introduction},methods:{toggleUploadCover(){this.$refs.avatarUploader.$refs.upload.$refs.input.click()},avatarChange(e){this.avatarImage=e},avatarConfirm(){this.sendAvatar(this.avatarImage.name)},avatarCancel(){this.avatarImage=null},async sendAvatar(e){const t=new FormData;t.append("photo",this.avatarImage.file);let a="";await j(t).then((t=>{t.data.success?a=t.data.picname:(this.$notify({group:"error",title:"上傳圖片失敗 !"}),this.newAvatarName="origin.jpg",this.articleVm.firstPhoto=e)})).catch((e=>{})),await N(a).then((e=>{e.data.success&&this.$notify({group:"success",title:"大頭貼修改成功"})})).catch((e=>{})),this.$emit("get-info")},toggleChangeName(){this.isShowNameInput=!this.isShowNameInput},onNameSubmit(e){B(e["user-new-name"]).then((e=>{e.data.success?(this.$notify({group:"success",title:"暱稱更新成功"}),this.$emit("get-info"),this.toggleChangeName()):this.$notify({group:"error",title:e.data.message})})).catch((e=>{}))},onNameInvalidSubmit(e){},onChangeIntro(){this.introError||(this.alertInfo={message:"是否確定更改敘述 ?",confirmMode:"nothing",messageClass:"text-lg font-bold text-myBrown md:text-xl"},this.$store.commit("SHOW_ALERT"))},changeIntroHandler(){$(this.userIntroduction).then((e=>{e.data.success?(this.$notify({group:"success",title:"敘述更新成功"}),this.$emit("get-info")):this.$notify({group:"error",title:e.data.message})})).catch((e=>{}))}}},P={class:"w-full"},A=f("h2",{class:"mb-8 text-2xl font-bold text-myBrown"}," 我的主頁 ",-1),F={class:"flex justify-between items-center border-b border-myBrown"},E={class:"flex grow items-center py-4 text-myBrown"},O=f("div",{class:"w-1/4 font-bold"}," 大頭貼 ",-1),_={class:"text-center"},V={class:"py-12 border-b border-myBrown"},k=f("div",{class:"mb-5 w-1/4 font-bold text-myBrown"}," 變更暱稱 ",-1),D={class:"flex flex-col gap-6"},M={class:"flex items-center text-myBrown"},T=f("div",{class:"w-1/4"}," 目前暱稱 ",-1),H={class:"font-semibold"},W={class:"flex gap-3 text-myBrown"},q=f("div",{class:"text-center"},[f("button",{type:"submit",class:"userPageButton"}," 確認更改 ")],-1),L={class:"text-center"},R={class:"py-12"},X=f("div",{class:"mb-5 w-1/4 font-bold text-myBrown"}," 個人主頁敘述 ",-1),Y={class:"text-sm text-red-500"},z={class:"text-right"},G=["disabled"];var J=S(U,[["render",function(e,t,a,o,s,c){const m=l,I=i,C=u("v-form"),S=r,j=n;return d(),g("div",P,[A,h(" 我的大頭貼 "),f("div",F,[f("div",E,[O,h(" 顯示大頭貼 "),f("div",null,[p(m,{ref:"avatarUploader",name:"avatar",class:"overflow-hidden w-[64px] rounded-full","fix-text":"修改","upload-bg":"bg-upload-cover","orig-image":e.userInfo.Userpic,"edit-mode":!0,"aspect-width":1,"aspect-height":1,"show-upload-button":!1,onFileChange:c.avatarChange,onFileConfirm:c.avatarConfirm,onFileCancel:c.avatarCancel},null,8,["orig-image","onFileChange","onFileConfirm","onFileCancel"])])]),h(" 上傳 "),f("div",_,[f("button",{type:"button",class:"userPageButton",onClick:t[0]||(t[0]=(...e)=>c.toggleUploadCover&&c.toggleUploadCover(...e))}," 上傳 ")])]),h(" 變更暱稱 "),f("div",V,[k,f("div",D,[h(" E-mail "),f("div",M,[T,f("div",null,[f("span",H,v(e.userInfo.Name),1)])]),b(p(C,{"validation-schema":s.nameSchema,onSubmit:c.onNameSubmit,onInvalidSubmit:c.onNameInvalidSubmit},{default:y((()=>[h(" 輸入暱稱 "),f("div",W,[p(I,{name:"user-new-name",type:"text",label:"輸入暱稱",placeholder:"輸入暱稱",class:"w-full","success-message":"","input-border":"focus:ring-2 focus:ring-myYellow"}),q])])),_:1},8,["validation-schema","onSubmit","onInvalidSubmit"]),[[w,s.isShowNameInput]]),f("div",L,[f("button",{type:"submit",class:"userPageButton",onClick:t[1]||(t[1]=(...e)=>c.toggleChangeName&&c.toggleChangeName(...e))}," 更改暱稱 ")])])]),h(" 個人主頁敘述 "),f("div",R,[X,f("div",null,[p(S,{modelValue:s.userIntroduction,"onUpdate:modelValue":t[2]||(t[2]=e=>s.userIntroduction=e),class:"",name:"user-introduction"},null,8,["modelValue"]),f("span",Y,v(s.introError),1),f("div",z,[f("button",{type:"button",class:"userPageButton",disabled:s.introError,onClick:t[3]||(t[3]=(...e)=>c.onChangeIntro&&c.onChangeIntro(...e))}," 更改敘述 ",8,G)])])]),p(j,x(s.alertInfo,{onAlertConfirm:c.changeIntroHandler}),null,16,["onAlertConfirm"])])}]]);export{J as default};
